# Laravel セキュリティプロジェクト作業ルール

## 🤖 Claude作業自動化ルール

### 基本作業フロー
1. **タスク開始時**: 対象タスクを`in_progress`に更新
2. **実装完了時**: タスクを`completed`に更新
3. **実装完了後**: 自動でCommit & Push実行
4. **エラー発生時**: 問題をTASK_STATUS.mdに記録

### 自動Commit & Pushルール
```bash
# 実装完了後、必ず以下を実行する：
git add .
git commit -m "[実装内容]

[詳細説明]

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>"
git push origin feat/phase1
```

### コミットメッセージ規則
- **日本語**で記述
- **実装内容の要約**を最初の行に
- **詳細な変更点**を箇条書きで記述
- **セキュリティ関連の修正**は必ず明記

### タスク管理ルール
- **TASK_STATUS.md**: 進捗追跡専用（タスクリストと完了状況）
- **CLAUDE.md**: 作業ルール定義専用（本ファイル）
- **各タスク完了時**: TASK_STATUS.mdを必ず更新

### セキュリティ実装基準
1. **認証・認可**: 全てのAdmin機能に適切な権限チェック
2. **入力検証**: 全ての入力に対してバリデーション実装
3. **ファイルアップロード**: 拡張子・MIMEタイプ・サイズチェック必須
4. **SQL対策**: パラメータ化クエリ使用、直接SQL禁止
5. **CSRF対策**: 全てのPOST/PUT/DELETE操作にトークン確認

### エラーハンドリング基準
- **400エラー**: 不正なパラメータ
- **403エラー**: 権限不足
- **404エラー**: リソース未発見
- **422エラー**: バリデーション失敗
- **500エラー**: サーバー内部エラー

### ファイル構成管理
```
app/
├── Http/
│   ├── Controllers/
│   │   ├── Admin/          # 管理者機能（要認証・認可）
│   │   └── Auth/           # 認証機能
│   ├── Middleware/
│   │   └── AdminAuth.php   # 管理者認証ミドルウェア
│   └── Requests/           # バリデーション専用クラス
├── Models/                 # Eloquentモデル（$fillable必須）
└── ...
```

### ブランチ管理ルール
- **main**: 本番リリース用
- **feat/phase1**: セキュリティ強化フェーズ1
- **feat/phase2**: 機能追加フェーズ2（予定）

### 作業完了判定基準
✅ **セキュリティ検証完了**
✅ **動作確認完了**
✅ **コードレビュー完了**
✅ **ドキュメント更新完了**
✅ **テスト実行完了**（該当する場合）

### 緊急時対応ルール
1. **致命的エラー発生時**: 即座に作業を中断し、ロールバック検討
2. **セキュリティ脆弱性発見時**: 優先度を最高に設定し、即座に対応
3. **データ破損リスク時**: バックアップ確認後に作業継続

### 品質保証ルール
- **Laravel標準**: フレームワークの規約に従った実装
- **PSR準拠**: PHP標準規約に準拠したコード
- **セキュリティファースト**: 機能よりもセキュリティを優先
- **可読性重視**: 将来のメンテナンス性を考慮

### 実装禁止事項
❌ **直接SQLクエリ実行**
❌ **eval()やexec()の使用**
❌ **パスワードの平文保存**
❌ **セッションIDの直接操作**
❌ **外部入力の無検証使用**

### 必須実装事項
✅ **入力検証（バリデーション）**
✅ **出力エスケープ（XSS対策）**
✅ **CSRFトークン確認**
✅ **認証・認可チェック**
✅ **エラーハンドリング**

---

## 📋 作業進捗は TASK_STATUS.md で管理

このファイルは**ルール定義専用**です。
実際のタスク進捗は `TASK_STATUS.md` を参照してください。