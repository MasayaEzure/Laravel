# Claude Code 作業ルール

## 基本作業フロー

### 1. タスク実装後の自動処理
- **実装完了後**: 自動でcommit・push実行
- **コミットメッセージ**: 実装内容を日本語で簡潔に記述
- **ブランチ**: feat/phase*番号
- **TASK_STATUS.md更新**: 完了タスクにチェックマーク追加と進捗率更新

### 2. ファイル管理ルール
- **TASK_STATUS.md**: タスク一覧と進捗状況を管理
- **CLAUDE.md**: 作業ルールと運用方針を記載
- **実装完了時**: TASK_STATUS.mdを更新してcommit

### 3. セキュリティ対応優先順位
1. **高優先度**: 即座に対応（任意コード実行、不正アクセス、データ漏洩等）
2. **中優先度**: 計画的に対応（設定最適化、入力検証強化等）
3. **低優先度**: 長期的に対応（監査ログ、テスト自動化等）

### 4. 実装品質基準
- **構文チェック**: php -l で全ファイルの構文エラー確認を必須
- **セキュリティ検証**: 明示的な検証処理を実装（Laravel標準 + 独自チェック）
- **テスト**: 実装後に動作確認を実施

### 5. 進捗報告ルール
- **各タスク完了時**: 実装内容、セキュリティ効果、解決した問題を報告
- **問題発生時**: 問題の詳細、解決策、代替案を提示
- **次のタスク提案**: TASK_STATUS.mdの優先度に基づいて次の作業を提案

## 技術実装ガイドライン

### Laravel開発必須規約
- **モデル**: $fillable配列を明示的に定義（$guarded禁止）
- **コントローラー**: 全メソッドにセキュリティチェック実装
- **バリデーション**: Laravel標準ルール + 独自検証の組み合わせ
- **ファイルアップロード**: 拡張子・MIMEタイプ・サイズの三重チェック

### Git運用ルール
- **コミット単位**: 1機能または1セキュリティ対策につき1コミット
- **メッセージ形式**: 「機能名：実装内容の詳細説明」
- **ブランチ運用**: feature/機能名またはfeat/phase番号
- **自動プッシュ**: 実装完了時に必ず実行

### セキュリティ必須チェック項目
- ファイルアップロード検証（拡張子・MIME・サイズ）
- SQL Injection対策（バインドパラメータ使用）
- XSS対策（エスケープ処理）
- CSRF対策（トークン検証）
- 認証・認可チェック（ユーザー権限確認）
- 直接オブジェクト参照対策（所有者確認）
- マスアサインメント対策（$fillable明示）

## 緊急時対応プロトコル

### セキュリティインシデント発生時
1. **即座に修正実装**（他のタスクを一時停止）
2. **TASK_STATUS.md緊急更新**
3. **緊急コミット・プッシュ実行**
4. **影響範囲と対策効果の詳細報告**
5. **再発防止策の提案**

### 実装ブロック・エラー発生時
1. **問題の詳細分析と原因特定**
2. **複数の代替案を提示**
3. **優先度の再評価と作業順序の調整**
4. **次善策の即座実行**
5. **学習事項の文書化**

### コミット・プッシュ失敗時
1. **エラー内容の詳細確認**
2. **競合解決またはブランチ切り替え**
3. **再実行までの手順を明確化**
4. **成功まで継続実行**

## 最終目標

**全11タスクの完了により、Laravelアプリケーションのセキュリティを大幅に向上させ、本番環境での安全な運用を実現する**